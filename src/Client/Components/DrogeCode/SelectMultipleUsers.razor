@using Drogecode.Knrm.Oefenrooster.Shared.Models.User;
@if (Users is not null && Functions is not null)
{
    <MudSelectExtended Clearable="@Clearable" T="DrogeUser" MultiSelectionTextFunc="@(new Func<List<DrogeUser>, string>(GetMultiSelectionText))" ToStringFunc="@(new Func<DrogeUser, string>(GetSelectedText))" Label="Label" MultiSelection="MultiSelection" SelectedValues="Selection" SelectedValuesChanged="OnSelectionChanged" ReadOnly="ReadOnly">
        @foreach (var function in Functions)
        {
            if (Users.Any(x => x.UserFunctionId == function.Id))
            {
                <MudSelectItemGroupExtended T="DrogeUser" Text="@function.Name" Sticky="true" @* InitiallyExpanded="Users.Any(y => y.UserFunctionId == function.Id && _selectedUsers.Any(x=>x.Id == y.Id) )" *@>
                    @foreach (var user in Users.Where(x => x.UserFunctionId == function.Id))
                    {
                        <MudSelectItemExtended T="DrogeUser" Value="@user">@user.Name</MudSelectItemExtended>
                    }
                </MudSelectItemGroupExtended>
            }
        }
    </MudSelectExtended>
}