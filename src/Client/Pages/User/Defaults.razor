@page "/user/defaults"
@attribute [Authorize]
@using Drogecode.Knrm.Oefenrooster.Shared.Enums;
@using Drogecode.Knrm.Oefenrooster.Shared.Models.DefaultSchedule;
<PageTitle>@L["Default schedule"]</PageTitle>

@if (_defaultSchedules is not null)
{
    <MudExpansionPanels>
        @foreach (var schedule in _defaultSchedules.OrderBy(x => x.Order).ThenBy(x => x.TimeStart))
        {
            <MudExpansionPanel Text='@($"{LApp[schedule.WeekDay.ToString() ?? "None"]} - {schedule.TimeStart} {LApp["till"]} {schedule.TimeEnd}")' MaxHeight="150">
                @if (schedule.UserSchedules is not null && schedule.UserSchedules.Count > 0)
                {
                    <MudDataGrid T="DefaultUserSchedule" Items="@schedule.UserSchedules" EditMode="DataGridEditMode.Form" EditTrigger="@DataGridEditTrigger.Manual"
                                 StartedEditingItem="@StartedEditingItem" CanceledEditingItem="@CanceledEditingItem" CommittedItemChanges="@CommittedItemChanges"
                                 ReadOnly="false" Bordered="true" Dense="true">
                        <Columns>
                            <PropertyColumn Property="x => x.ValidFromUser" Title="@L["ValidFrom"]" />
                            <PropertyColumn Property="x => x.ValidUntilUser" Title="@L["ValidUntil"]" />
                            <PropertyColumn Property="x => x.Available" Title="@L["Availability"]">
                                <CellTemplate>
                                    @LApp[context.Item.Available.ToString() ?? "None"]
                                </CellTemplate>
                            </PropertyColumn>
                            <TemplateColumn CellClass="d-flex justify-end">
                                <CellTemplate>
                                    <MudIconButton Size="@Size.Small" Icon="@Icons.Material.Outlined.Edit" OnClick="@context.Actions.StartEditingItemAsync" />
                                </CellTemplate>
                            </TemplateColumn>
                        </Columns>
                    </MudDataGrid>
                }
                else
                {

                    <MudText>No default configuration</MudText>
                }
            </MudExpansionPanel>
        }
    </MudExpansionPanels>
}
else
{
    <MudSkeleton />
    <MudSkeleton />
    <MudSkeleton />
    <MudSkeleton />
}