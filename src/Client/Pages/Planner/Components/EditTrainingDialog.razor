@using Drogecode.Knrm.Oefenrooster.Client.Repositories;
@using Drogecode.Knrm.Oefenrooster.Shared.Enums;
@using Drogecode.Knrm.Oefenrooster.Shared.Helpers;
@using Drogecode.Knrm.Oefenrooster.Shared.Models.Schedule
<MudDialog>
    <DialogContent>
        @if (_training == null || TrainingTypes == null)
        {
            <MudSkeleton SkeletonType="SkeletonType.Rectangle" Width="200px" Height="110px" />
        }
        else
        {
            <MudForm @ref="_form" @bind-IsValid="@_success" @bind-Errors="@_errors">
                <MudTextField Label="@L["Name"]" @bind-Value="_training.Name" MaxLength="@DefaultSettingsHelper.MAX_LENGTH_TRAINING_TITLE" />
                <MudDatePicker Label="@L["Date"]" @bind-Date="_training.Date" Required />
                <MudTimePicker Label="@L["From"]" @bind-Time="_training.TimeStart" Validation="@(new Func<TimeSpan?, string?>(StartBeforeEndValidation))" Required />
                <MudTimePicker Label="@LApp["till"]" @bind-Time="_training.TimeEnd" Validation="@(new Func<TimeSpan?, string?>(EndAfterStartValidation))" Required />
                <MudSelect T="Guid?" Label="@L["Training type"]" AnchorOrigin="Origin.BottomCenter" Value="_training.RoosterTrainingTypeId" ValueChanged="RoosterTrainingTypeChanged" Required>
                @foreach (PlannerTrainingType trainingType in TrainingTypes.OrderBy(x => x.Order))
                    {
                        <MudSelectItem T="Guid?" Value="@trainingType.Id">@trainingType.Name</MudSelectItem>
                    }
                </MudSelect>
                <MudSwitchM3 Label="@L["Count to training target"]" T="bool" @bind-Checked="_training.CountToTrainingTarget" />
                <MudDivider />
                <MudSwitchM3 Label="@L["Pin to dashboard"]" T="bool" @bind-Checked="_training.Pin" />
                @if (Vehicles != null)
                {
                    <MudText Typo="Typo.h4">@L["Which vehicle?"]</MudText>
                    @if (_linkVehicleTraining != null)
                    {
                        foreach (var vehicle in Vehicles.Where(x => x.Active))
                        {
                            bool? isSelected = _linkVehicleTraining?.FirstOrDefault(x => x.Vehicle == vehicle.Id)?.IsSelected;
                            <MudSwitch T="bool" CheckedChanged="(e)=> CheckChanged(e, vehicle)" Color="Color.Success" Label="@vehicle.Name" Tag="@vehicle" Checked="@(isSelected == true || (isSelected == null && vehicle.Default))" /> <br />
                        }
                    }
                }
            </MudForm>
        }
    </DialogContent>
    <DialogActions>
        @if (_training?.IsNew == true)
        {
            <MudButton OnClick="Cancel">@LApp["Cancel"]</MudButton>
            <MudButton Color="Color.Primary" OnClick="OnSubmit">@LApp["save"]</MudButton>
        }
    </DialogActions>
</MudDialog>

