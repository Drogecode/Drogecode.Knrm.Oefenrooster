@using Drogecode.Knrm.Oefenrooster.Shared.Models.User;
<div>
    <MonthSelector Month="_month" MonthChanged="SetMonth"/>
    @if (Users != null)
    {
        <MudTable Hover="true" Breakpoint="Breakpoint.Sm"
                  Items="@Users.OrderBy(x => Functions?.FirstOrDefault(y => y.Id == x.UserFunctionId)?.Order).ThenBy(x=>x.Name)"
                  GroupBy="@_groupBy"
                  GroupHeaderStyle="background-color:var(--mud-palette-background-grey)"
                  GroupFooterClass="mb-4"
                  FixedHeader="true"
                  Height=" calc(100vh - 200px)"
                  Dense="true"
                  Bordered="true">
            <HeaderContent>
                <MudTh>@L["Name"]</MudTh>
                @foreach (var item in _events)
                {
                    <MudTh Class="@($"trainingType-{item.RoosterTrainingTypeId}")">
                        @item.DateStart.ToString("dddd")
                        <DateToString ShowDate="true" ShowTime="true" DateTimeUtc="item.DateStart" /> @item.Name
                    </MudTh>
                }
            </HeaderContent>
            <GroupHeaderTemplate>
                <MudTh Class="mud-table-cell-custom-group" colspan="5">
                    @($"{Functions?.FirstOrDefault(y => y.Id == (Guid)context.Key)?.Name ?? L["Unknown"]}")
                </MudTh>
            </GroupHeaderTemplate>
            <RowTemplate>
                <MudTd Class="DrogeCode-sticky-column" DataLabel="@L["Name"]">@context.Name</MudTd>
                @foreach (var item in _events)
                {
                    var training = item.PlanUsers?.FirstOrDefault(x => x.UserId == @context.Id);
                    <MudTd Class="@PlannerHelper.StyleAvailabilty(training?.Availabilty)" DataLabel="@L["Name"]">
                        @if (training?.Assigned == true)
                        {
                            @(Vehicles?.FirstOrDefault(x => x.Id == training.VehicleId)?.Code ?? Vehicles?.FirstOrDefault(x => x.Default)?.Code ?? L["Assigned"])
                        }
                    </MudTd>
                }
            </RowTemplate>
        </MudTable>
    }
</div>
@code {
    TableGroupDefinition<DrogeUser> _groupBy = new()
        {
            GroupName = "Group",
            Indentation = false,
            Expandable = true,
            IsInitiallyExpanded = true,
            Selector = (e) => e.UserFunctionId
        };
}