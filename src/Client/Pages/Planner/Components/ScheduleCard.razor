@using Drogecode.Knrm.Oefenrooster.Client.Pages.Components
@using Drogecode.Knrm.Oefenrooster.Client.Pages.Planner.Components
@using Drogecode.Knrm.Oefenrooster.Client.Repositories;
@using Drogecode.Knrm.Oefenrooster.Shared.Models.Schedule
@using Drogecode.Knrm.Oefenrooster.Shared.Enums;
@if (!_isDelted)
{
    <CalendarBaseCard ReplaceEmtyName="@ReplaceEmtyName" Width="@Width" Training="@Planner" OnClickCallback="OpenScheduleDialog" OnClickSettings="OpenConfigDialog" OnClickHistory="OpenHistoryDialog" ShowDate="@ShowDate">
        @if (ChildContent is not null)
        {
            @ChildContent
        }
        @if (Functions is not null)
        {
            <MudList>
                @foreach (var vehicle in Vehicles.Where(x => Planner.PlanUsers?.Any(y => y.VehicleId == x.Id) == true || (x.IsDefault && Planner.PlanUsers?.Any(y => y.VehicleId == null) == true)))
                {
                    @if (Functions.Any(f => f.Active) && (Planner.PlanUsers?.Any(x => x.Assigned && (x.VehicleId == vehicle.Id || (vehicle.IsDefault && x.VehicleId == null))) == true))
                    {
                        <MudText Typo="Typo.subtitle2">@vehicle.Name</MudText>
                    }
                    @foreach (var function in Functions.Where(x => x.Active).OrderBy(x => x.Order))
                    {
                        @if (Planner.PlanUsers?.Any(x => x.Assigned && x.PlannedFunctionId == function.Id && (x.VehicleId == vehicle.Id || (vehicle.IsDefault && x.VehicleId == null))) == true)
                        {
                            @foreach (var assignedUser in Planner.PlanUsers.Where(x => x.Assigned && x.PlannedFunctionId == function.Id && (x.VehicleId == vehicle.Id || (vehicle.IsDefault && x.VehicleId == null))))
                            {
                                <MudListItem>@assignedUser.Name@(assignedUser.PlannedFunctionId != assignedUser.UserFunctionId ? $" - {LApp["as"]} {function.Name}" : "")</MudListItem>
                            }
                        }
                    }
                }
            </MudList>
        }
    </CalendarBaseCard>
}
