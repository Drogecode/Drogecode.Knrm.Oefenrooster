@page "/configuration/day-item"
@using Drogecode.Knrm.Oefenrooster.Shared.Enums
@attribute [Authorize(Roles = AccessesNames.AUTH_scheduler_dayitem)]
<MudAlert Severity="Severity.Info" Variant="Variant.Filled">Werkt (nog) niet op mobiel</MudAlert>
<PageTitle>@L["Day items"]</PageTitle>
<MudPaper Elevation="0" Class="p-2">
    <MudText Typo="Typo.h4">@L["Add and change day item"]</MudText>
    @if (_items is not null)
    {
        <MudButton StartIcon="@Icons.Material.Filled.Add" OnClick="()=>{OpenDayItemDialog(null, true);}">@L["Add new day item"]</MudButton>
        <MudTable Items="_items.OrderBy(x=>x.DateStart)">
            <HeaderContent>
                <MudTh>@LApp["Description"]</MudTh>
                <MudTh>@LApp["Type"]</MudTh>
                <MudTh>@LApp["Who"]</MudTh>
                <MudTh>@LApp["From"]</MudTh>
                <MudTh>@LApp["Till"]</MudTh>
                <MudTh>@LApp["Edit"]</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="@LApp["Description"]">@context.Text</MudTd>
                <MudTd DataLabel="@LApp["Type"]">@context.Type</MudTd>
                <MudTd DataLabel="@LApp["Who"]">@_users?.FirstOrDefault(x=>x.Id == context?.LinkedUsers?.FirstOrDefault()?.UserId)?.Name</MudTd>
                <MudTd DataLabel="@LApp["From"]"><DateToString ShowDate="true" ShowTime="false" DateTimeUtc="@context.DateStart" /></MudTd>
                <MudTd DataLabel="@LApp["Till"]"><DateToString ShowDate="true" ShowTime="false" DateTimeUtc="@context.DateEnd" /></MudTd>
                <MudTd DataLabel="@LApp["Edit"]">
                    @if(context.Type != CalendarItemType.SpecialDate)
                    {
                        <MudIconButton Icon="@Icons.Material.Filled.Delete" OnClick="async ()=>{await Delete(context);}" />
                        <MudIconButton Icon="@Icons.Material.Filled.Edit" OnClick="()=>{OpenDayItemDialog(context, false);}" />
                    }
                </MudTd>
            </RowTemplate>
        </MudTable>
    }
    else
    {
        <MudSkeleton />
        <MudSkeleton />
        <MudSkeleton />
        <MudSkeleton />
    }
</MudPaper>